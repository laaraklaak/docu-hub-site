<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Docu-Hub | Luxury Concierge & Compliance</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: '#003366',
                        gold: '#D4AF37',
                        emerald: '#059669',
                        paper: '#F5F0EC',
                        glass: 'rgba(255, 255, 255, 0.95)'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,600;0,700;1,600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* LUXURY TACTILE UI */
        body { background-color: #F5F0EC; color: #003366; -webkit-font-smoothing: antialiased; }
        
        .btn-primary {
            background: #003366; color: white; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #003366; position: relative; overflow: hidden;
        }
        .btn-primary:active { transform: scale(0.95); }
        .btn-primary:hover { background: #D4AF37; border-color: #D4AF37; color: #003366; }
        .btn-secondary {
            background: transparent; color: #003366; border: 1px solid #003366; transition: all 0.3s;
        }
        .btn-secondary:hover { background: #F5F0EC; }
        .btn-disabled { background: #9ca3af; cursor: not-allowed; opacity: 0.5; transform: none !important; border-color: #9ca3af; }

        .card-interaction {
            transition: all 0.4s ease; border: 1px solid rgba(0,0,0,0.05);
        }
        .card-interaction:hover {
            transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #D4AF37;
        }
        .card-active {
            border: 2px solid #D4AF37; transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* SCROLL TRAP STYLING */
        .scroll-trap {
            scrollbar-width: thin; scrollbar-color: #D4AF37 #f1f1f1;
        }
        .scroll-trap::-webkit-scrollbar { width: 6px; }
        .scroll-trap::-webkit-scrollbar-track { background: #f1f1f1; }
        .scroll-trap::-webkit-scrollbar-thumb { background-color: #D4AF37; border-radius: 20px; }

        /* SENSORY OVERLAY */
        .sensory-overlay {
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
        }
        
        .fade-enter { opacity: 0; transform: translateY(20px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 0.5s, transform 0.5s; }
        
        canvas { background: #fff; border: 1px dashed #cbd5e1; border-radius: 0.5rem; cursor: crosshair; }
        
        /* FORM TRANSITIONS */
        .step-container { display: none; animation: fadeIn 0.4s ease-in-out; }
        .step-container.active-step { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="pb-0 flex flex-col min-h-screen">

    <nav class="sticky top-0 z-40 bg-navy/95 backdrop-blur text-white border-b border-gold/30">
        <div class="max-w-4xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i data-lucide="shield-check" class="text-gold" size="24"></i>
                <div>
                    <h1 class="font-serif font-bold text-lg tracking-widest uppercase">Docu-Hub</h1>
                    <p class="text-[9px] uppercase tracking-[0.2em] text-gold">Operations Services</p>
                </div>
            </div>
            <div class="hidden md:block text-[10px] font-mono text-gold border border-gold px-2 py-1 rounded">
                SECURE: AES-256
            </div>
        </div>
    </nav>

    <header class="relative h-[240px] md:h-[320px] w-full overflow-hidden flex items-center justify-center bg-navy">
        <img src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?auto=format&fit=crop&q=80&w=1000" class="absolute inset-0 w-full h-full object-cover opacity-40 mix-blend-overlay">
        <div class="relative z-10 text-center space-y-4 px-4">
            <span class="inline-block px-3 py-1 bg-gold/20 text-gold border border-gold rounded-full text-[10px] font-bold uppercase tracking-widest backdrop-blur-sm">
                Editorial Mission Hub
            </span>
            <h2 class="font-serif text-3xl md:text-5xl text-white italic">The Compliance Concierge</h2>
            <p class="text-white/80 text-sm max-w-md mx-auto font-light">Precision logistics for Jamaica's most demanding protocols.</p>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-6 -mt-10 relative z-20 space-y-16 flex-grow">

        <section id="leg-1" class="fade-enter-active">
            <div class="flex items-baseline gap-4 mb-6 border-b border-navy/10 pb-4">
                <span class="font-serif text-4xl text-navy/20 italic">01</span>
                <h3 class="text-xl font-bold text-navy uppercase tracking-wide">Select Service Suite</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div id="service-grid" class="contents"></div>
            </div>
        </section>

        <section id="leg-2" class="hidden opacity-50 transition-all duration-500">
            <div class="flex items-baseline gap-4 mb-6 border-b border-navy/10 pb-4">
                <span class="font-serif text-4xl text-navy/20 italic">02</span>
                <h3 class="text-xl font-bold text-navy uppercase tracking-wide">Requirements Audit</h3>
            </div>
            <div class="bg-white p-8 rounded-xl shadow-lg border-t-4 border-emerald">
                <div class="flex items-start gap-4 mb-6">
                    <div class="bg-emerald/10 p-3 rounded-full text-emerald">
                        <i data-lucide="clipboard-list" size="24"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-navy text-lg">Physical Document Check</h4>
                        <p class="text-xs text-gray-500 mt-1">Please confirm possession of the following before proceeding.</p>
                    </div>
                </div>
                <div id="checklist-container" class="space-y-3 mb-8"></div>
                <button onclick="confirmAudit()" class="btn-primary w-full py-4 rounded font-bold uppercase text-xs tracking-widest">
                    Confirm Possession & Proceed
                </button>
            </div>
        </section>

        <section id="leg-3" class="hidden opacity-50 transition-all duration-500">
            <div class="flex items-baseline gap-4 mb-6 border-b border-navy/10 pb-4">
                <span class="font-serif text-4xl text-navy/20 italic">03</span>
                <h3 class="text-xl font-bold text-navy uppercase tracking-wide">Master Agreement</h3>
            </div>
            <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="bg-navy text-white p-4 text-xs font-bold uppercase tracking-widest flex justify-between">
                    <span>Terms of Engagement</span>
                    <span>READ TO BOTTOM</span>
                </div>
                <div id="terms-scroll" class="scroll-trap h-64 overflow-y-auto p-6 text-xs text-gray-600 space-y-4 leading-relaxed text-justify">
                    <p class="font-bold text-navy">AGREEMENT BETWEEN CLIENT AND LAURA CLARKE T/A DOCU-HUB OPERATIONS SERVICES.</p>
                    <p><strong>1. AUTHORITY TO ACT:</strong> By signing this digital instrument, you authorize Docu-Hub to act as your liaison with the selected Government Agency (PICA, TAJ, RGD, JCF).</p>
                    <p><strong>2. DUAL-CLOCK POLICY (DATA RETENTION):</strong> You acknowledge our strict data lifecycle policy. <strong>Standard ID documents</strong> (Birth Certs, Passports) are purged from our digital systems after <strong>30 days</strong>. <strong>Financial records</strong> (Tax receipts, Business filings) are retained in cold storage for <strong>7 years</strong> as required by Jamaican financial law.</p>
                    <p><strong>3. LIABILITY LIMITATION:</strong> Docu-Hub is a logistics facilitator. We are not responsible for delays caused by government system outages, strikes, or force majeure events.</p>
                    <p><strong>4. FEES & REFUNDS:</strong> The Professional Liaison Fee is non-refundable once the service has commenced. Government Agency Fees are passed directly to the institution.</p>
                    <p class="text-red-600 font-bold">*** END OF AGREEMENT ***</p>
                </div>
                <div class="p-6 bg-gray-50 border-t border-gray-200">
                    <label class="flex items-center gap-4 cursor-not-allowed opacity-50 transition-opacity duration-300" id="agree-label">
                        <input type="checkbox" id="check-agree" disabled class="w-5 h-5 accent-navy">
                        <span class="text-xs font-bold text-navy">I accept the Terms, Dual-Clock Policy, and Liaison Authority.</span>
                    </label>
                    <button id="btn-agree" disabled onclick="confirmAgreement()" class="mt-4 btn-primary btn-disabled w-full py-4 rounded font-bold uppercase text-xs tracking-widest transition-all">
                        Accept & Continue
                    </button>
                </div>
            </div>
        </section>

        <section id="leg-4" class="hidden opacity-50 transition-all duration-500">
            <div class="flex items-baseline gap-4 mb-4 border-b border-navy/10 pb-4">
                <span class="font-serif text-4xl text-navy/20 italic">04</span>
                <h3 class="text-xl font-bold text-navy uppercase tracking-wide">Forensic Intake</h3>
            </div>

            <div class="bg-white rounded-xl shadow-xl overflow-hidden border border-gray-200">
                <div class="bg-gray-100 h-2 w-full">
                    <div id="progress-bar" class="bg-gold h-full w-1/3 transition-all duration-500 ease-out"></div>
                </div>

                <div class="bg-navy p-4 flex items-center justify-between text-white">
                    <div>
                        <p class="text-[10px] uppercase text-gold font-bold tracking-widest">Active Protocol</p>
                        <h3 id="lbl-active-service" class="font-serif text-xl italic">Service Name</h3>
                    </div>
                    <i id="icon-active-service" data-lucide="shield" class="text-gold opacity-50"></i>
                </div>

                <form id="intake-form" onsubmit="return false;" class="p-8 min-h-[400px]">
                    
                    <div id="step-1" class="step-container active-step space-y-6">
                        <h4 class="text-2xl font-serif text-navy italic mb-6">Identity Verification</h4>
                        <div class="space-y-4">
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold uppercase text-gray-400">Full Legal Name</label>
                                <input type="text" id="client_name" class="w-full p-4 border rounded-lg bg-gray-50 focus:bg-white focus:border-navy outline-none transition-colors font-serif text-lg">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[10px] font-bold uppercase text-gray-400">Email Address</label>
                                <input type="email" id="client_email" class="w-full p-4 border rounded-lg bg-gray-50 focus:bg-white focus:border-navy outline-none transition-colors font-sans">
                            </div>
                        </div>
                        <div class="pt-8">
                            <button onclick="nextStep(2)" class="btn-primary w-full py-4 rounded-lg font-bold uppercase text-xs tracking-widest">
                                Next: Service Details
                            </button>
                        </div>
                    </div>

                    <div id="step-2" class="step-container space-y-6">
                        <h4 class="text-2xl font-serif text-navy italic mb-6">Service Logistics</h4>
                        <div id="step-2-content" class="grid grid-cols-1 gap-6"></div>
                        
                        <div class="pt-8 flex gap-4">
                            <button onclick="prevStep(1)" class="btn-secondary w-1/3 py-4 rounded-lg font-bold uppercase text-xs tracking-widest">
                                Back
                            </button>
                            <button onclick="nextStep(3)" class="btn-primary w-2/3 py-4 rounded-lg font-bold uppercase text-xs tracking-widest">
                                Next: Ratify
                            </button>
                        </div>
                    </div>

                    <div id="step-3" class="step-container space-y-6">
                        <h4 class="text-2xl font-serif text-navy italic mb-6">Digital Ratification</h4>
                        
                        <div class="bg-gray-50 p-6 rounded-xl border border-dashed border-gray-300">
                            <label class="block text-[10px] font-bold uppercase text-gray-400 mb-2">Sign within the box</label>
                            <canvas id="sig-canvas" width="600" height="150" class="w-full bg-white border border-gray-200 rounded cursor-crosshair"></canvas>
                            <div class="flex justify-between mt-2">
                                <button onclick="clearSig()" class="text-[10px] text-red-500 font-bold uppercase hover:underline">Clear Signature</button>
                                <span class="text-[10px] text-gray-400">Authorized by Client</span>
                            </div>
                        </div>

                        <div class="pt-8 flex gap-4">
                            <button onclick="prevStep(2)" class="btn-secondary w-1/3 py-4 rounded-lg font-bold uppercase text-xs tracking-widest">
                                Back
                            </button>
                            <button onclick="submitPayload()" class="btn-primary w-2/3 py-4 rounded-lg font-bold uppercase text-xs tracking-widest shadow-xl">
                                Transmit Securely
                            </button>
                        </div>
                    </div>

                </form>
            </div>
        </section>

        <section class="mt-16 mb-8 cursor-pointer group" onclick="openHelpOverlay()">
            <div class="relative h-48 rounded-2xl overflow-hidden shadow-xl border-2 border-white/50 group-hover:border-gold transition-all duration-300">
                <img src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&q=80&w=1000" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-r from-navy/90 to-transparent"></div>
                <div class="absolute inset-0 flex flex-col justify-center px-10">
                    <div class="bg-gold/20 backdrop-blur w-fit px-3 py-1 rounded-full border border-gold/40 mb-3">
                        <span class="text-[9px] font-bold text-gold uppercase tracking-widest">Concierge Desk</span>
                    </div>
                    <h3 class="font-serif text-3xl text-white italic mb-2">Need Guidance?</h3>
                    <p class="text-white/80 text-xs font-light max-w-sm">Access our Knowledge Base for document checklists, payment protocols, and compliance tips.</p>
                </div>
            </div>
        </section>

    </main>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-navy/90 backdrop-blur text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-6 border border-white/10">
        <button onclick="openHelpOverlay()" class="text-[10px] font-bold uppercase tracking-widest hover:text-gold transition-colors">Help Centre</button>
        <div class="h-4 w-px bg-white/20"></div>
        <a href="#" class="text-[10px] font-bold uppercase tracking-widest hover:text-gold transition-colors">Track Case</a>
    </div>

    <footer class="bg-navy border-t border-gold text-white/80 py-16 mt-auto">
        <div class="max-w-4xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-10 text-xs">
            <div class="space-y-4">
                <h4 class="font-bold text-white uppercase tracking-widest text-lg">Docu-Hub Ops</h4>
                <p class="font-light">Laura Clarke T/A Docu-Hub.<br>Spanish Town, St. Catherine.</p>
            </div>
            <div class="space-y-3">
                <h4 class="font-bold text-white uppercase tracking-widest border-b border-white/10 pb-2 mb-2 w-fit">Compliance</h4>
                <a href="#" class="block hover:text-gold">Privacy Policy (JDPA)</a>
                <a href="#" class="block hover:text-gold">Dual-Clock Retention</a>
            </div>
            <div class="space-y-3">
                <h4 class="font-bold text-white uppercase tracking-widest border-b border-white/10 pb-2 mb-2 w-fit">Contact</h4>
                <p>admin@dochubservices.com</p>
                <p>1 (876) 561-2614</p>
            </div>
        </div>
    </footer>

    <div id="status-overlay" class="fixed inset-0 z-[100] hidden flex items-center justify-center sensory-overlay bg-navy/40">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full mx-4 text-center">
            <div id="status-icon" class="mx-auto mb-4 w-12 h-12 flex items-center justify-center rounded-full bg-navy/10 text-navy">
                <i data-lucide="loader" class="animate-spin"></i>
            </div>
            <h3 id="status-title" class="font-serif text-2xl font-bold text-navy mb-2">Processing</h3>
            <p id="status-msg" class="text-sm text-gray-600 mb-6">Securely handshaking with server...</p>
            <button id="status-btn" onclick="closeOverlay('status-overlay')" class="hidden w-full py-3 rounded border border-navy text-navy font-bold uppercase text-xs hover:bg-navy hover:text-white">Close</button>
        </div>
    </div>

    <div id="help-overlay" class="fixed inset-0 z-[100] hidden flex items-end md:items-center justify-center sensory-overlay bg-navy/60">
        <div class="bg-white w-full md:max-w-2xl h-[80vh] md:h-auto rounded-t-3xl md:rounded-2xl shadow-2xl overflow-hidden flex flex-col">
            <div class="bg-navy p-6 flex justify-between items-center text-white shrink-0">
                <h3 class="font-serif text-2xl italic">Knowledge Base</h3>
                <button onclick="closeOverlay('help-overlay')" class="hover:text-gold"><i data-lucide="x"></i></button>
            </div>
            <div class="p-8 overflow-y-auto space-y-8">
                <div>
                    <h4 class="font-bold text-navy mb-2">Document Standards</h4>
                    <p class="text-sm text-gray-600">All uploads must be 300 DPI. No glare or blur.</p>
                </div>
                <div>
                    <h4 class="font-bold text-navy mb-2">Payment Protocols</h4>
                    <p class="text-sm text-gray-600">Fees due upon engagement. Agency fees are pass-through.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzX7CSHDzfPCH3SsEeUCrHTE9X7omiskVh8ogPGm5Wvva9Xw0cK_9vaQYKyls10m2Ni/exec";

        const SERVICES = [
            { id: 'pica', name: 'Passport Renewal', fee: '$6,500', liaison: '$3,500', icon: 'passport', image: 'https://images.unsplash.com/photo-1544298583-363673523274?auto=format&fit=crop&q=80&w=400', fields: [{ id: 'old_ppt', label: 'Last Passport Number', type: 'text' }, { id: 'expiry', label: 'Expiration Date', type: 'date' }] },
            { id: 'jcf', name: 'Police Record', fee: '$3,000', liaison: '$4,000', icon: 'fingerprint', image: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&q=80&w=400', fields: [{ id: 'parish', label: 'Parish of Residence', type: 'text' }, { id: 'reason', label: 'Reason for Record', type: 'text' }] },
            { id: 'rgd', name: 'Vital Records', fee: '$2,500', liaison: '$3,500', icon: 'scroll', image: 'https://images.unsplash.com/photo-1596567215160-b8832a833504?auto=format&fit=crop&q=80&w=400', fields: [{ id: 'mother_name', label: 'Mother\'s Maiden Name', type: 'text' }, { id: 'event_parish', label: 'Event Parish', type: 'text' }] },
            { id: 'taj', name: 'Tax / Vehicle', fee: '$Var', liaison: '$2,500', icon: 'car', image: 'https://images.unsplash.com/photo-1550355291-bbee04a92027?auto=format&fit=crop&q=80&w=400', fields: [{ id: 'plate_num', label: 'License Plate / TRN', type: 'text' }, { id: 'trans_type', label: 'Transaction Type', type: 'text' }] },
            { id: 'corp', name: 'Corporate Bulk', fee: 'Custom', liaison: 'Quote', icon: 'building', image: 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80&w=400', fields: [{ id: 'company_name', label: 'Registered Company Name', type: 'text' }, { id: 'staff_count', label: 'Number of Staff', type: 'number' }] },
            { id: 'consult', name: 'Consultation', fee: '$5,000', liaison: 'Included', icon: 'search', image: 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?auto=format&fit=crop&q=80&w=400', fields: [{ id: 'case_summary', label: 'Brief Case Summary', type: 'text' }, { id: 'book_date', label: 'Preferred Date', type: 'date' }] }
        ];

        let state = { selected: null, sigData: null, currentStep: 1 };

        window.onload = () => { lucide.createIcons(); renderServices(); initSigPad(); initScrollTrap(); };

        function renderServices() {
            document.getElementById('service-grid').innerHTML = SERVICES.map(s => `
                <div onclick="selectService('${s.id}')" id="card-${s.id}" class="card-interaction bg-white rounded-xl cursor-pointer group relative overflow-hidden flex flex-col h-full shadow-sm hover:shadow-xl">
                    <div class="h-32 w-full overflow-hidden relative"><img src="${s.image}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"><div class="absolute inset-0 bg-navy/20 group-hover:bg-transparent transition-colors"></div></div>
                    <div class="p-6 flex flex-col flex-grow"><h4 class="font-serif font-bold text-lg text-navy mb-1">${s.name}</h4><div class="mt-auto pt-4 border-t border-gray-100 text-[10px] font-mono text-gray-500 space-y-1"><div class="flex justify-between"><span>AGENCY FEE</span> <span class="text-navy font-bold">${s.fee}</span></div><div class="flex justify-between"><span>LIAISON FEE</span> <span class="text-gold font-bold">${s.liaison}</span></div></div></div>
                    <div class="absolute inset-0 border-2 border-transparent group-hover:border-gold/50 rounded-xl transition-colors pointer-events-none active-border"></div>
                </div>`).join('');
            lucide.createIcons();
        }

        function selectService(id) {
            state.selected = SERVICES.find(s => s.id === id);
            document.querySelectorAll('.card-interaction').forEach(c => { c.classList.remove('card-active'); c.querySelector('.active-border').classList.remove('border-gold'); });
            const activeCard = document.getElementById(`card-${id}`);
            activeCard.classList.add('card-active');
            activeCard.querySelector('.active-border').classList.add('border-gold');
            
            // Populate Checklist
            document.getElementById('checklist-container').innerHTML = `
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded border border-gray-200"><input type="checkbox" class="audit-check accent-emerald"><span class="text-xs font-bold text-navy">Govt Issued ID</span></label>
                <label class="flex items-center gap-3 p-3 bg-gray-50 rounded border border-gray-200"><input type="checkbox" class="audit-check accent-emerald"><span class="text-xs font-bold text-navy">TRN Card / Slip</span></label>
            `;
            revealSection('leg-2');
        }

        function revealSection(id) {
            const el = document.getElementById(id);
            el.classList.remove('hidden');
            setTimeout(() => el.classList.remove('opacity-50'), 100);
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function confirmAudit() {
            if(!Array.from(document.querySelectorAll('.audit-check')).every(c => c.checked)) { showStatus('Attention', 'Confirm possession of documents.', 'alert-triangle', 'text-gold'); return; }
            revealSection('leg-3');
        }

        function initScrollTrap() {
            const box = document.getElementById('terms-scroll'), check = document.getElementById('check-agree'), btn = document.getElementById('btn-agree'), label = document.getElementById('agree-label');
            box.addEventListener('scroll', () => { if (Math.abs(box.scrollHeight - box.clientHeight - box.scrollTop) < 5) { check.disabled = false; label.classList.remove('opacity-50', 'cursor-not-allowed'); } });
            check.addEventListener('change', () => { btn.disabled = !check.checked; btn.classList.toggle('btn-disabled', !check.checked); });
        }

        function confirmAgreement() {
            renderIntakeForm();
            revealSection('leg-4');
        }

        // --- NEW STEPPED LOGIC ---
        function renderIntakeForm() {
            // Set Header
            document.getElementById('lbl-active-service').innerText = state.selected.name;
            document.getElementById('icon-active-service').setAttribute('data-lucide', state.selected.icon);
            lucide.createIcons();

            // Populate Step 2 (Dynamic Fields)
            const container = document.getElementById('step-2-content');
            let html = ``;
            state.selected.fields.forEach(f => {
                html += `<div class="space-y-1"><label class="text-[10px] font-bold uppercase text-gray-400">${f.label}</label><input type="${f.type}" id="${f.id}" class="w-full p-4 border rounded-lg bg-gray-50 focus:bg-white focus:border-navy outline-none transition-colors font-sans"></div>`;
            });
            container.innerHTML = html;
        }

        function nextStep(target) {
            // Validation Logic
            if(target === 2) {
                const name = document.getElementById('client_name').value;
                const email = document.getElementById('client_email').value;
                if(!name || !email) { showStatus('Missing Data', 'Please enter Name and Email.', 'alert-circle', 'text-red-500'); return; }
            }
            if(target === 3) {
                 // Basic check to see if fields in Step 2 are empty
                 const inputs = document.querySelectorAll('#step-2-content input');
                 let empty = false;
                 inputs.forEach(i => { if(!i.value) empty = true; });
                 if(empty) { showStatus('Missing Data', 'Please fill all service details.', 'alert-circle', 'text-red-500'); return; }
            }

            // Move Step
            document.querySelectorAll('.step-container').forEach(s => s.classList.remove('active-step'));
            document.getElementById(`step-${target}`).classList.add('active-step');
            
            // Update Progress Bar
            const width = target === 1 ? '33%' : (target === 2 ? '66%' : '100%');
            document.getElementById('progress-bar').style.width = width;
            state.currentStep = target;
        }

        function prevStep(target) {
            document.querySelectorAll('.step-container').forEach(s => s.classList.remove('active-step'));
            document.getElementById(`step-${target}`).classList.add('active-step');
            
            const width = target === 1 ? '33%' : (target === 2 ? '66%' : '100%');
            document.getElementById('progress-bar').style.width = width;
            state.currentStep = target;
        }

        // --- CANVAS SIGNATURE ---
        let canvas, ctx, drawing = false;
        function initSigPad() {
            canvas = document.getElementById('sig-canvas'); ctx = canvas.getContext('2d');
            ctx.strokeStyle = "#003366"; ctx.lineWidth = 2;
            canvas.addEventListener('mousedown', startDraw); canvas.addEventListener('mouseup', stopDraw); canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e.touches[0]); }); canvas.addEventListener('touchend', stopDraw); canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); });
        }
        function getPos(e) { const rect = canvas.getBoundingClientRect(); return { x: e.clientX - rect.left, y: e.clientY - rect.top }; }
        function startDraw(e) { drawing = true; const pos = getPos(e); ctx.beginPath(); ctx.moveTo(pos.x, pos.y); }
        function stopDraw() { drawing = false; }
        function draw(e) { if(!drawing) return; const pos = getPos(e); ctx.lineTo(pos.x, pos.y); ctx.stroke(); }
        function clearSig() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        // --- TRANSMISSION ---
        function submitPayload() {
            state.sigData = canvas.toDataURL();
            let sopData = {};
            state.selected.fields.forEach(f => { sopData[f.label] = document.getElementById(f.id).value; });

            showStatus('Authenticating', 'Encrypting payload for transmission...', 'loader', 'text-navy', true);

            const payload = {
                name: document.getElementById('client_name').value,
                email: document.getElementById('client_email').value,
                service: state.selected.name,
                sopData: sopData,
                signature: state.sigData
            };

            fetch(SCRIPT_URL, {
                method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(payload)
            }).then(() => {
                setTimeout(() => { showStatus('Success', 'Case initiated. Check email.', 'check-circle', 'text-emerald'); document.getElementById('status-btn').classList.remove('hidden'); }, 2000);
            }).catch(err => {
                showStatus('Transmission Error', 'Secure handshake failed.', 'wifi-off', 'text-red-500'); document.getElementById('status-btn').classList.remove('hidden');
            });
        }

        function showStatus(title, msg, icon, colorClass, spin = false) {
            const ol = document.getElementById('status-overlay'); ol.classList.remove('hidden');
            document.getElementById('status-title').innerText = title; document.getElementById('status-msg').innerText = msg;
            document.getElementById('status-icon').innerHTML = `<i data-lucide="${icon}" class="${colorClass} ${spin ? 'animate-spin' : ''}" size="32"></i>`;
            lucide.createIcons();
            document.getElementById('status-btn').classList.toggle('hidden', spin);
        }
        function openHelpOverlay() { document.getElementById('help-overlay').classList.remove('hidden'); }
        function closeOverlay(id) { document.getElementById(id).classList.add('hidden'); }
    </script>
</body>
</html>
